# YOLO 데이터 어노테이션 도구 생성 프롬프트

다음은 이 YOLO 데이터 어노테이션 도구와 같은 프로그램을 생성하기 위한 상세한 프롬프트입니다.

## 기본 프롬프트

```
YOLO v8 객체탐지 모델 학습을 위한 데이터 전처리, 자동 검출, 증식, 분할 프로그램을 PyQt5, OpenCV, YOLO-World, Ultralytics, CLIP을 사용하여 개발해주세요.

## 주요 기술 스택:
- **PyQt5**: GUI 프레임워크
- **OpenCV**: 이미지 처리 및 변환  
- **YOLO-World**: Zero-shot 객체 자동 검출
- **Ultralytics**: YOLO 모델 및 YOLOv8s-WorldV2 지원
- **CLIP**: 텍스트-이미지 매칭 (YOLO-World용)
- **NumPy**: 수치 연산 및 배열 처리
- **JSON**: 설정 파일 관리

## UI 화면 구성 요구사항:

### 전체 레이아웃:
- 왼쪽: 메뉴 버튼들
- 가운데: 이미지 표출창 (크기 조절 가능)
- 오른쪽 상단: 클래스(Box labels) 선택 라디오 버튼
- 오른쪽 하단: 원본 파일 목록(File List)
- 가운데와 오른쪽 사이에 스플리터로 크기 조절 가능

### 왼쪽 메뉴바 구성:
1. **Image Dir** 버튼: 이미지 폴더 선택
2. **Label Dir** 버튼: 레이블 파일 저장 폴더 선택
3. **Prev Image** 버튼: 이전 이미지
4. **Next Image** 버튼: 다음 이미지  
5. **Save** 버튼: 현재 어노테이션 저장
6. **Yolo-World** 버튼: YOLO-World 자동 검출 모드 전환 (토글)
7. **Data Aug** 버튼: 데이터 증식 모드 전환 (토글)
8. **Data Split** 버튼: 데이터셋 분할 (Train/Valid/Test)
9. **Undo** 버튼: 작업 취소
10. **Redo** 버튼: 작업 재실행

### 바운딩 박스 편집 기능:
- **그리기**: 마우스 좌클릭 드래그로 새 바운딩 박스 생성
- **이동**: Ctrl + 드래그로 바운딩 박스 이동
- **크기 조절**: Alt + 드래그로 바운딩 박스 크기 조절 (8개 핸들: 4모서리 + 4가장자리)
- **삭제**: 마우스 우클릭으로 삭제 (확인 팝업 "바운딩 박스를 삭제할까요?")
- **클래스별 색상**: 각 클래스마다 다른 색상으로 바운딩 박스 표시
- **최소 크기 제한**: 가로, 세로 각각 5픽셀 미만인 바운딩 박스는 생성/저장 금지

### 키보드 조작:
- File List에서 위/아래 화살표 키로 이미지 전환 가능

### YOLO-World 자동 검출 기능:
Yolo-World 버튼 클릭 시 오른쪽 패널에 체크박스 모드로 변경:
1. **다중 클래스 선택**: classes.txt의 모든 클래스를 체크박스로 표시
2. **🔍 Detect Objects** 버튼: 선택된 클래스들에 대해 자동 검출 실행
3. **Zero-shot 검출**: YOLOv8s-WorldV2 모델을 사용한 사전 학습 없는 객체 검출
4. **CLIP 통합**: 텍스트-이미지 매칭을 통한 정확한 검출
5. **수동 편집 통합**: 자동 검출 후 기존 편집 기능으로 추가 수정 가능

### 데이터 증식 기능:
Data Aug 버튼 클릭 시 가운데 창이 데이터 증식 선택 창으로 변경:
1. **워킹 디렉토리 선택**: 증식 데이터 저장 위치 지정
2. **이미지 좌우 대칭** (체크박스)
3. **이미지 수직 대칭** (체크박스)  
4. **이미지 회전** (체크박스 + 각도 입력 스핀박스)
   - **Interval 체크박스**: 설정 각도 간격으로 360도까지 다중 회전 생성
   - 예: 30도 + Interval 체크 시 → 30°, 60°, 90°... 330°까지 생성
5. **이미지 스케일 변경** (체크박스 + 스케일 값 입력: 0.1~2.0, 0.1 단위)
6. **증식 적용** 버튼

### 데이터 분할 기능:
Data Split 버튼 클릭 시 데이터셋 분할 창으로 변경:
1. **비율 설정**: Train/Valid/Test 비율 슬라이더
2. **워킹 디렉토리 선택**: 분할된 데이터 저장 위치
3. **데이터 분할 실행** 버튼
4. **자동 구조 생성**: data/train/, data/valid/, data/test/ 폴더 자동 생성
5. **라벨 매칭**: 이미지와 대응하는 라벨 파일만 포함

### 설정 관리:
- Image Dir와 Label Dir 설정을 config.txt 파일에 JSON 형식으로 저장
- 프로그램 시작 시 이전 설정 자동 로드
- 각 버튼 아래에 현재 설정된 디렉토리명 표시 (작은 글자)

### ### 파일 관리:
- classes.txt 파일에서 클래스 목록 읽어와서 라디오 버튼/체크박스 구성
- YOLO 형식으로 레이블 저장 (class_id center_x center_y width height)
- **스마트 저장**: 바운딩 박스 편집 시에만 자동 저장 (파일 탐색 시 자동 저장 안함)
- **워킹 디렉토리 지원**: 사용자 지정 폴더에 결과 저장
- 증식된 데이터는 '워킹디렉토리/augmented/images'와 '워킹디렉토리/augmented/labels' 폴더로 분리 저장
- 분할된 데이터는 '워킹디렉토리/data/train/', '워킹디렉토리/data/valid/', '워킹디렉토리/data/test/' 폴더로 구조화 저장
- **Model 파일 관리**: .gitignore에 *.pt 파일 제외 설정

### 필수 설치 패키지:
```bash
pip install PyQt5 opencv-python numpy ultralytics
pip install git+https://github.com/ultralytics/CLIP.git
```

### Undo/Redo 시스템:
- 명령 패턴(Command Pattern) 사용
- 바운딩 박스 생성, 삭제, 이동, 크기조절 모든 작업에 대해 Undo/Redo 지원
- 새 이미지 로드 시 히스토리 초기화

### 저장 동작 상세:
- **자동 저장 조건**: 바운딩 박스 추가, 이동, 크기조절, 삭제, Undo/Redo 시에만 즉시 저장
- **자동 저장 안함**: 파일 선택, Prev/Next 버튼, 키보드 탐색 시 자동 저장 안함  
- **변경 추적**: annotations_changed 플래그로 실제 변경 여부 추적
- **디렉토리 변경 보호**: Image Dir/Label Dir 변경 시 기존 작업이 있으면 저장 후 변경

### 추가 요구사항:
- 이미지 크기를 UI 창에 맞게 자동 조절하여 표시
- 마우스 커서가 상황에 따라 변경 (이동: 십자화살표, 크기조절: 양방향화살표 등)
- 프로그램 시작 시 기존 레이블 파일 보호 (자동 저장으로 인한 덮어쓰기 방지)
- 에러 처리 및 예외 상황 대응
- File List 높이가 창 크기에 반응하여 자동 조절
- 마우스 위치에 따른 수직/수평 가이드라인 표시
- YOLO-World 사용 시 CLIP 모듈 자동 설치 안내

이 모든 기능을 포함하여 완전히 동작하는 프로그램을 만들어주세요.
```

## 고급 기능 추가 프롬프트

```
위의 기본 기능에 추가로 다음 고급 기능들을 구현해주세요:

### 1. YOLO-World 자동 검출:
- YOLOv8s-WorldV2 모델 통합
- CLIP 기반 텍스트-이미지 매칭
- 다중 클래스 동시 검출
- Zero-shot 학습 없는 객체 인식
- 자동 검출 후 수동 편집 연계

### 2. 향상된 UI/UX:
- 스플리터로 이미지창과 파일리스트 크기 조절 가능
- 디렉토리 버튼 아래 현재 폴더명 표시 (16px 크기)
- 툴팁으로 전체 경로 표시
- 반응형 레이아웃
- File List 높이 자동 조절

### 3. 고급 편집 기능:
- 8개 핸들로 정밀한 크기 조절 (모서리 4개 + 가장자리 4개)
- 드래그 중 실시간 피드백
- 이미지 경계 내에서만 편집 가능
- 최소 크기 제한 (5x5 픽셀)

### 4. 데이터 보호:
- 프로그램 시작 시 자동 저장 방지 플래그
- 기존 레이블 파일 보호
- 안전한 파일 읽기/쓰기

### 5. 성능 최적화:
- 이미지 캐싱 최적화
- 메모리 효율적인 이미지 처리
- 대용량 이미지 자동 스케일링

### 6. 확장성:
- 모듈화된 구조
- 새로운 증식 기법 추가 용이
- 설정 시스템 확장 가능

이러한 고급 기능들을 포함하여 더욱 전문적이고 사용하기 편한 도구로 업그레이드해주세요.

참고: SAM2 관련 모든 기능은 제거되었으므로 구현하지 마세요.
```

## 단계별 개발 프롬프트

### 1단계: 기본 구조
```
먼저 PyQt5를 사용한 기본 UI 구조를 만들어주세요:
- 메인 윈도우 클래스
- 왼쪽 메뉴바, 가운데 이미지 캔버스, 오른쪽 패널
- 기본 버튼들과 레이아웃
```

### 2단계: 이미지 처리
```
OpenCV를 사용한 이미지 로드 및 표시 기능을 추가해주세요:
- 이미지 파일 읽기
- 크기 조절하여 화면에 맞게 표시
- 마우스 좌표를 이미지 좌표로 변환
```

### 3단계: 바운딩 박스
```
바운딩 박스 그리기 및 편집 기능을 구현해주세요:
- 마우스 드래그로 박스 그리기
- 클래스별 다른 색상 표시
- 박스 정보 저장 구조
```

### 4단계: 고급 편집
```
Ctrl/Alt 조합키를 사용한 고급 편집 기능을 추가해주세요:
- Ctrl + 드래그: 이동
- Alt + 드래그: 크기 조절
- 8개 핸들 지원
- 마우스 커서 변경
```

### 5단계: Undo/Redo
```
명령 패턴을 사용한 Undo/Redo 시스템을 구현해주세요:
- Command 추상 클래스
- AddBBoxCommand, DeleteBBoxCommand, MoveBBoxCommand, ResizeBBoxCommand
- 스택 기반 히스토리 관리
```

### 6단계: 파일 관리
```
YOLO 형식의 파일 읽기/쓰기 및 설정 관리를 추가해주세요:
- classes.txt 읽기
- YOLO 레이블 형식 저장/로드
- config.txt JSON 설정 관리
```

### 7단계: YOLO-World 통합
```
YOLO-World 자동 검출 기능을 구현해주세요:
- YOLOv8s-WorldV2 모델 로드
- CLIP 모듈 통합
- 다중 클래스 체크박스 UI
- Zero-shot 객체 검출
- 검출 결과를 바운딩 박스로 변환
```

### 8단계: 데이터 증식
```
다양한 데이터 증식 기능을 구현해주세요:
- 워킹 디렉토리 선택 UI
- 이미지 변환 (flip, rotate, scale)
- Interval 회전 모드 (각도 간격별 다중 생성)
- 정밀 스케일 조절 (0.1~2.0, 0.1 단위)
- 어노테이션 좌표 변환
- 증식된 데이터 워킹 디렉토리에 자동 저장
```

### 9단계: 데이터 분할
```
학습용 데이터셋 분할 기능을 구현해주세요:
- Train/Valid/Test 비율 설정 UI
- 이미지-레이블 파일 매칭
- YOLO 학습 최적화 폴더 구조 생성
- 분할된 데이터셋 자동 저장
```

## 디버깅 및 최적화 프롬프트

```
다음 문제들을 해결하고 최적화해주세요:

### 설치 및 환경 문제:
1. **CLIP 모듈 누락**: YOLO-World 사용을 위한 CLIP 설치 필요
   ```bash
   pip install git+https://github.com/ultralytics/CLIP.git
   # 또는
   pip install openai-clip
   ```

2. **Qt 플랫폼 플러그인 오류** (WSL/Linux)
   ```bash
   export QT_QPA_PLATFORM=offscreen
   ```

3. **YOLO-World 모델 다운로드**: 첫 실행 시 자동 다운로드

### 일반적인 문제:
1. 프로그램 시작 시 첫 이미지 레이블 삭제 문제
2. 이미지 크기가 계속 커지는 문제
3. 워킹 디렉토리 권한 문제

### 해결 방법:
1. loading_initial_image 플래그로 초기 자동 저장 방지
2. 원본 이미지 기준으로 작업, 스케일 팩터 제한
3. 워킹 디렉토리 존재 여부 확인 및 자동 생성
4. YOLO-World 모델 로드 실패 시 명확한 오류 메시지 제공

### 최적화:
- 메모리 사용량 최소화
- UI 응답성 향상
- 파일 I/O 최적화
```

## 현재 버전 정보 (v3.0)

### 주요 파일:
- **yolo_data_preprocessing_tool.py**: 메인 애플리케이션 파일 (최신)
- **classes.txt**: 클래스 정의 파일
- **config.txt**: 설정 저장 파일 (자동 생성)
- **.gitignore**: Git 무시 파일 (*.pt 포함)

### 버전 내역:
- **v3.0 (최신)**: YOLO-World, 데이터 증식 고도화, 데이터 분할, SAM2 제거
- **v2.0**: SAM2 세그멘테이션, 데이터 증식 기본 기능
- **v1.0**: 기본 바운딩 박스 편집 기능

### 제거된 기능:
- SAM2 세그멘테이션 기능 (완전 제거됨)
- SAM2 버튼 및 관련 UI
- SAM2Settings 위젯

## 사용 예시

이 프롬프트들을 사용하여:
1. **전체 기능** 한 번에 요청하거나
2. **단계별로** 점진적 개발하거나  
3. **특정 기능만** 선택적으로 구현할 수 있습니다.

각 프롬프트는 구체적인 요구사항과 기술적 세부사항을 포함하므로, AI가 정확하고 완전한 코드를 생성할 수 있도록 도와줍니다.

**주의**: 현재 버전에서는 SAM2 기능이 완전히 제거되었으므로 SAM2 관련 코드는 구현하지 마세요.