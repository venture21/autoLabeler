# YOLO 데이터 전처리 및 어노테이션 도구

YOLO v8 객체 탐지 모델 학습을 위한 전문적인 데이터 어노테이션 및 증식 프로그램입니다. PyQt5와 OpenCV를 사용하여 개발되었으며, 직관적인 GUI를 통해 효율적인 바운딩 박스 편집을 지원합니다.

## 🎯 주요 기능

### 바운딩 박스 편집
- **그리기**: 마우스 좌클릭 드래그로 새 바운딩 박스 생성
- **이동**: `Ctrl + 드래그`로 바운딩 박스 이동
- **크기 조절**: `Alt + 드래그`로 바운딩 박스 크기 조절 (8개 핸들 지원)
- **삭제**: 마우스 우클릭으로 삭제 (한국어 확인 팝업)
- **클래스별 색상**: 각 클래스마다 다른 색상으로 바운딩 박스 표시
- **최소 크기 제한**: 5픽셀 미만 바운딩 박스 생성 방지

### 스마트 저장 시스템
- **자동 저장**: 바운딩 박스 편집 시에만 자동 저장
- **변경 추적**: 실제 변경이 있을 때만 파일 저장
- **데이터 보호**: 프로그램 시작 시 기존 레이블 파일 보호
- **안전한 탐색**: 파일 선택 시 자동 저장하지 않음

### Undo/Redo 시스템
- **명령 패턴**: 모든 편집 작업에 대한 취소/재실행 지원
- **무제한 히스토리**: 메모리 허용 범위 내에서 무제한 Undo/Redo
- **이미지별 관리**: 새 이미지 로드 시 히스토리 초기화

### 데이터 증식
- **좌우 대칭**: 수평 flip 변환
- **수직 대칭**: 수직 flip 변환  
- **회전**: 사용자 정의 각도로 회전 (어노테이션 자동 변환)
- **스케일 변경**: 비율 유지하면서 크기 조절
- **구조화된 저장**: `augmented/images/`와 `augmented/labels/` 폴더로 분리 저장

### 사용자 인터페이스
- **한국어 지원**: 모든 UI 요소와 메시지 한국어 제공
- **반응형 레이아웃**: 스플리터로 영역 크기 조절 가능
- **키보드 탐색**: 파일 리스트에서 ↑↓ 키로 빠른 이미지 전환
- **상태 표시**: 현재 설정된 디렉토리 경로 표시 (16px 크기)

## 🛠 설치 및 실행

### 필요 패키지
```bash
pip install PyQt5 opencv-python numpy
```

### 실행
```bash
python yolo_data_preprocessing_tool.py
```

### 환경 설정 (WSL/Linux)
Qt 플랫폼 오류 시:
```bash
export QT_QPA_PLATFORM=offscreen
```

## 📁 파일 구조

```
project/
├── yolo_data_preprocessing_tool.py  # 메인 프로그램
├── classes.txt                      # 클래스 정의 파일
├── config.txt                       # 설정 저장 파일 (자동 생성)
├── images/                          # 원본 이미지 폴더
├── labels/                          # YOLO 레이블 폴더
└── augmented/                       # 증식된 데이터 폴더
    ├── images/                      # 증식된 이미지
    └── labels/                      # 증식된 레이블
```

### classes.txt 예시
```
car
bus
truck
```

## 🎮 사용법

### 1. 초기 설정
1. **이미지 디렉토리** 버튼으로 이미지 폴더 선택
2. **레이블 디렉토리** 버튼으로 레이블 저장 폴더 선택
3. `classes.txt` 파일에 클래스 목록 정의

### 2. 어노테이션 작업
1. 파일 목록에서 이미지 선택
2. 박스 라벨에서 현재 클래스 선택
3. 마우스 드래그로 바운딩 박스 그리기
4. 편집 기능 사용:
   - `Ctrl + 드래그`: 박스 이동
   - `Alt + 드래그`: 박스 크기 조절 (8개 핸들)
   - `우클릭`: 박스 삭제

### 3. 데이터 증식
1. **데이터 증식** 버튼 클릭
2. 원하는 증식 옵션 선택 (대칭, 회전, 스케일)
3. **증식 적용** 버튼으로 실행
4. `augmented/` 폴더에 결과 확인

## ⌨️ 단축키

| 키 조합 | 기능 |
|---------|------|
| `마우스 드래그` | 새 바운딩 박스 그리기 |
| `Ctrl + 드래그` | 바운딩 박스 이동 |
| `Alt + 드래그` | 바운딩 박스 크기 조절 |
| `우클릭` | 바운딩 박스 삭제 |
| `↑/↓` | 파일 리스트에서 이미지 전환 |

## 🔧 기술 스택

- **Python 3.x**
- **PyQt5**: GUI 프레임워크
- **OpenCV**: 이미지 처리 및 변환
- **NumPy**: 수치 연산 및 배열 처리
- **JSON**: 설정 파일 관리

## 💡 특징

### 안정성
- **명령 패턴**: Undo/Redo를 위한 안정적인 아키텍처
- **예외 처리**: 파일 I/O 및 이미지 처리 오류 방지
- **데이터 무결성**: 프로그램 시작 시 기존 데이터 보호

### 사용성
- **직관적 조작**: 드래그 앤 드롭 방식의 간편한 편집
- **시각적 피드백**: 마우스 커서 변경으로 현재 모드 표시
- **실시간 업데이트**: 편집 내용 즉시 반영 및 저장

### 확장성
- **모듈화 구조**: 각 기능별 클래스 분리
- **설정 관리**: JSON 기반 유연한 설정 저장
- **플러그인 가능**: 새로운 증식 기법 추가 용이

## 🐛 문제 해결

### 일반적인 문제
1. **Qt 플랫폼 오류**
   ```bash
   export QT_QPA_PLATFORM=offscreen
   ```

2. **이미지 로드 실패**
   - 지원 형식: .jpg, .png, .bmp, .jpeg
   - 파일 권한 확인

3. **레이블 파일 오류**
   - YOLO 형식 준수: `class_id center_x center_y width height`
   - 좌표 값 범위: 0.0 ~ 1.0

### 성능 최적화
- **메모리 관리**: 대용량 이미지 자동 스케일링
- **캐싱**: 이미지 로드 최적화
- **병렬 처리**: 데이터 증식 작업 효율화

## 📝 YOLO 레이블 형식

```
class_id center_x center_y width height
0 0.5 0.5 0.3 0.4
1 0.2 0.3 0.1 0.2
```

- **class_id**: 클래스 인덱스 (0부터 시작)
- **center_x, center_y**: 바운딩 박스 중심점 (정규화된 좌표)
- **width, height**: 바운딩 박스 크기 (정규화된 크기)

## 🏗 아키텍처

### 주요 클래스
- **MainWindow**: 메인 UI 및 전체 애플리케이션 관리
- **ImageCanvas**: 이미지 표시 및 바운딩 박스 편집
- **DataAugmentationWidget**: 데이터 증식 UI 및 기능
- **Command 패턴**: Undo/Redo 시스템

### 명령 패턴 구현
- **AddBBoxCommand**: 바운딩 박스 추가
- **DeleteBBoxCommand**: 바운딩 박스 삭제
- **MoveBBoxCommand**: 바운딩 박스 이동
- **ResizeBBoxCommand**: 바운딩 박스 크기 조절

## 🔄 업데이트 이력

### v1.0 (최신)
- 초기 릴리스
- 모든 핵심 기능 구현
- 한국어 완전 지원
- 스마트 저장 시스템 적용

---

**개발자**: Claude Code Assistant  
**라이선스**: 교육 및 연구 목적 자유 사용  
**문의**: 이슈 발생 시 소스 코드 검토 또는 문의